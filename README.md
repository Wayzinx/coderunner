# 代码执行工具

一个强大的插件，可以根据请求内容自动生成代码并执行，然后返回执行结果。本工具支持代码调试和持久化存储。

## 使用方法

### 自然语言交互 (推荐)

现在，您可以直接使用自然语言来生成和执行代码，无需使用命令！AI会自动调用相应的工具函数：

- 描述您想要完成的任务，比如：
  - "帮我写个程序计算1到100的和"
  - "创建一个JavaScript程序来检查一个字符串是否是回文"
  - "生成一个bash脚本列出当前目录下的所有.txt文件"

AI将自动理解您的需求，生成相应的代码并执行，然后返回结果。

### 基本命令 (传统方式)

如果您仍然喜欢使用命令，以下命令依然可用：

- **执行Python代码**: `/run_python 计算1+1的结果`
- **执行JavaScript代码**: `/run_js 计算数组[1,2,3,4,5]的总和`
- **自定义语言（两种方式）**: 
  - `/run language=语言名 执行任务描述`
  - `/run_with_args language=语言名 执行任务描述 更多描述`

> 注意: 如果遇到"_empty() takes no arguments"错误，请使用`/run_with_args`命令，它支持更灵活的参数处理。

### 支持的编程语言

- Python (默认)
- JavaScript (Node.js)
- Bash
- 更多语言正在添加中...

### 多种输出形式

新版本支持三种输出方式，让代码的表达能力更强：

1. **文本输出**（send_text）：输出文本信息
2. **图像输出**（send_image）：生成并显示图片，如图表、图形等
3. **文件输出**（send_file）：生成并提供文件下载，如数据文件、文档等

#### 使用方法示例：

```python
from shared.api import send_text, send_image, send_file
import matplotlib.pyplot as plt
import numpy as np

# 生成图表
x = np.linspace(0, 10, 100)
y = np.sin(x)
plt.figure(figsize=(8, 6))
plt.plot(x, y)
plt.title('正弦波图形')
plt.savefig('output/sin_wave.png')  # 保存到output目录

# 发送结果
send_text('以下是正弦波函数图像：')  # 发送文本
send_image('output/sin_wave.png')   # 发送图像
```

### 特色功能

#### 自动调试
当代码执行失败时，系统会自动尝试调试并修复代码，最多进行3次调试尝试。每次调试都会分析错误信息并生成修复后的代码。

#### 代码持久化存储
所有成功执行的代码都会被临时保存，图片和文件输出会在展示后一段时间内自动清理。

### 安全限制

为确保安全，代码执行存在以下限制：
- 执行时间上限为10秒
- 内存使用上限为100MB
- 不允许访问系统敏感文件和目录
- 禁止某些危险系统调用

## 示例

### 自然语言示例
```
我想要编写一个函数来生成斐波那契数列的前10个数字
```

```
画一个正弦和余弦函数的对比图，并添加图例
```

```
帮我创建一个简单的HTML文件，包含一个标题和一段文字，然后保存并返回
```

### 命令示例
请求Python代码计算斐波那契数列：
```
/run_python 生成一个函数计算斐波那契数列的第n项，并计算第10项的值
```

请求JavaScript代码处理数组：
```
/run_js 编写代码找出数组[3,1,4,1,5,9,2,6]中的最大值和最小值，并计算它们的差值
```

使用可变参数命令：
```
/run_with_args language=bash 创建一个脚本，列出当前目录下的所有文件，并按大小排序
``` 